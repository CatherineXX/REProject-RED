'''
@Author: ttwen
@Time: 2019年3月17日17:25:06
@Description: 会员管理的test方法
'''
import re
from django.test import TestCase

from django.template.loader import render_to_string
from api.models import Member
from users.models import UserProfile


class MemberViewTest(TestCase):

    def setUp(self):
        """
               创建一条用户信息数据
               :return: None
               """
        UserProfile.objects.create(id=1,
                                   password='pbkdf2_sha256$36000$4cg1SAMlOhxd$ONEWDCYTR/kbWBuwpMIo1GUJvMsC+cHZgFUl9YF6KC0=',
                                   is_superuser=1,
                                   username='cheertt',
                                   first_name='cheertt',
                                   last_name='油炸皮卡丘',
                                   email='1913278504@qq.com',
                                   is_staff=1,
                                   is_active=1,
                                   date_joined='2019-03-01 14:56:48.298648',
                                   name='python1234',
                                   mobile='15189392222',
                                   type=2, )

        self.login_user = {'username': 'cheertt', 'password': '123456'}

        Member.objects.create(id=555,
                              openid='oGLko4rWaEMwy-VByQ1-18cvOohE',
                              face_json='0.036559153348207474,0.08373403549194336,-0.011797050014138222,0.04624997824430466,0.025076016783714294,-0.01207118108868599,-0.07856795936822891,0.05712473765015602,0.007860626094043255,0.05686897039413452,0.050450075417757034,-0.008315500803291798,-0.04996833950281143,-0.01975405402481556,0.012321515008807182,-0.013053436763584614,0.017841583117842674,0.02883785590529442,-0.04660415276885033,0.009326557628810406,-0.03773665800690651,-0.00701349601149559,0.03498910367488861,-0.04799353703856468,-0.057087983936071396,0.013709718361496925,0.03205070272088051,0.00230220309458673,-0.026918072253465652,0.06182778254151344,-0.01492899376899004,0.04896128550171852,0.014268521219491959,0.021358896046876907,-0.001049318234436214,-0.08510676771402359,-0.011480029672384262,-0.09327000379562378,-0.04116204380989075,-0.024950094521045685,-0.05823281779885292,0.00998514611274004,0.002862168475985527,0.025685248896479607,0.01829138770699501,0.030931593850255013,-0.0016260620905086398,0.0414259247481823,-0.02943301945924759,-0.004530621226876974,-0.01767296902835369,-0.054461412131786346,0.0392126701772213,-0.02309233881533146,-0.01581854373216629,0.018590204417705536,-0.07066038995981216,0.03776098042726517,0.017902513965964317,0.034753695130348206,-0.051867835223674774,0.02795860357582569,-0.03395616635680199,0.03627704456448555,-0.01767679676413536,-0.023414531722664833,-0.07335412502288818,-0.02424224652349949,0.04796293377876282,0.002723530400544405,-0.0004656938253901899,0.035049859434366226,-0.016178984194993973,0.02063092216849327,0.005104640498757362,-0.01594940572977066,-0.06161041557788849,-0.07529667764902115,0.055623989552259445,0.04472581669688225,0.09157359600067139,-0.010766045190393925,0.0008186263148672879,0.0012290814192965627,0.015236715786159039,0.01140405423939228,-0.035401202738285065,0.05177035182714462,0.042594000697135925,-0.02599666640162468,-0.04195430502295494,-0.001806870219297707,0.08261436223983765,-0.07160302996635437,0.004771774169057608,0.06919749081134796,-0.015713639557361603,0.10728537291288376,0.04331488907337189,0.00030389594030566514,0.047575488686561584,0.07832370698451996,-0.03863731399178505,0.08611241728067398,0.049802571535110474,0.011759279295802116,0.004977015778422356,-0.07595395296812057,0.028031308203935623,-0.07218693941831589,0.053788211196660995,0.0008622425375506282,-0.0398426279425621,-0.06986487656831741,-0.01821701042354107,0.07215236127376556,0.045743539929389954,-0.004651212599128485,-0.003633988555520773,0.05095183104276657,0.013508428819477558,0.024096542969346046,-0.016796136274933815,-0.04456067457795143,0.0419943667948246,-0.06976480782032013,0.08027669042348862,-0.05681270733475685,-0.02482927218079567,-0.03161224350333214,-0.048011086881160736,-0.010130200535058975,0.06531211733818054,-0.02989780157804489,-0.007705907803028822,0.004939017351716757,-0.05021944269537926,-0.05485369637608528,0.028782285749912262,0.09231698513031006,0.022901343181729317,0.05941644683480263,-0.10351268947124481,0.005961175076663494,0.06135812774300575,0.00854243990033865,-0.03186538442969322,0.05297103896737099,-0.00895664095878601,0.06271942704916,0.025801600888371468,0.04472539946436882,0.004837768618017435,0.07959131896495819,-0.007648797240108252,0.0010399892926216125,-0.08981509506702423,-0.04742288589477539,-0.04759298264980316,-0.13978908956050873,0.0932852253317833,0.04448225349187851,-0.012161449529230595,0.045515354722738266,0.025291617959737778,-0.03308553621172905,-0.01729554682970047,0.06571227312088013,-0.08311006426811218,0.0513620562851429,0.010985586792230606,-0.0013665083097293973,-0.0306682325899601,0.037374481558799744,-0.026941891759634018,0.04029526934027672,-0.032816044986248016,0.017097963020205498,-0.031957801431417465,-0.009404121898114681,0.0051142130978405476,-0.019076349213719368,0.0161896999925375,0.025115840137004852,0.09190873056650162,-0.00763353006914258,0.034712452441453934,0.05076468363404274,0.05709352344274521,0.056027594953775406,0.04143974184989929,0.07123707234859467,0.09587927907705307,-0.09061179310083389,0.09478850662708282,2.5299261324107647e-05,0.014910968020558357,-0.05535569414496422,0.0463649183511734,-0.0455346405506134,0.06413671374320984,-0.03598296269774437,0.0785803571343422,-0.024793820455670357,0.07158670574426651,0.05857570841908455,0.04683531075716019,0.0030349665321409702,-0.0154359620064497,0.07250324636697769,-0.02496221289038658,0.02046780474483967,0.024402497336268425,-0.028886018320918083,0.027809035032987595,0.0385417714715004,0.037951719015836716,0.026832234114408493,-0.022723417729139328,0.010697985999286175,-0.051395732909440994,0.04548358544707298,0.027914000675082207,0.013329234905540943,0.06473962962627411,0.027110254392027855,0.005736238323152065,0.051683757454156876,-0.019918588921427727,0.06879546493291855,0.05236053466796875,-0.04016844928264618,-0.05545369163155556,-0.02819427289068699,-0.03383792191743851,-0.0062786731868982315,-0.018539419397711754,0.03626837208867073,0.0045190248638391495,0.003941357601433992,0.029016517102718353,0.04718325659632683,0.02320506051182747,-0.007191246375441551,0.041822630912065506,0.09100179374217987,-0.04347078129649162,-0.0005384981050156057,0.07736846804618835,0.034498509019613266,-0.04570961371064186,0.018682995811104774,0.08889535814523697,0.008116709999740124,-0.02271806262433529,-0.013001016341149807,-0.028816374018788338,0.09520594030618668,0.05647648498415947,0.00013571548333857208,-0.013400171883404255,-0.047486890107393265,0.10503038018941879,-0.03912648558616638,0.018125906586647034,-0.08047927916049957,0.014820612967014313,0.06351585686206818,-0.00013316584227140993,-0.10410136729478836,0.03795035928487778,0.012289983220398426,0.06860311329364777,0.03614199906587601,-0.04297224432229996,0.020335186272859573,0.008932061493396759,0.05997822806239128,0.018086418509483337,0.024903975427150726,-0.030761264264583588,0.0716298446059227,-0.024022933095693588,-0.04673793539404869,-0.028361592441797256,-0.013121231459081173,0.08093801885843277,0.024388564750552177,-0.07458031922578812,-0.033916499465703964,-0.04535304382443428,-0.005944624077528715,-0.025932347401976585,0.06859787553548813,-0.018678469583392143,-0.051553819328546524,-0.015791015699505806,-0.058533333241939545,0.024463655427098274,0.00273521919734776,0.03330157324671745,-0.009114614687860012,-0.05523999407887459,0.004216302651911974,0.04794282093644142,0.0388994999229908,0.04060347005724907,-0.023477209731936455,-0.06493660807609558,0.03803626447916031,-0.06672761589288712,0.019039515405893326,-0.02055705152451992,-0.01806257665157318,0.08104455471038818,-0.002869030926376581,-0.05888393521308899,0.009584837593138218,0.06256431341171265,-0.0537521094083786,0.010008770041167736,-0.024127904325723648,-0.02864089421927929,0.028653545305132866,-0.043144263327121735,-0.010265888646245003,0.02092970907688141,0.06601005792617798,0.000861109874676913,0.01644146628677845,0.08906576037406921,0.05545888841152191,-0.05988830700516701,0.012632492929697037,-0.007342396769672632,0.07794173806905746,-0.0170854814350605,0.004946288652718067,-0.014894340187311172,-0.07445128262042999,0.06314944475889206,0.024114418774843216,0.011995024047791958,0.013323185965418816,-0.000649638066533953,-0.00019983724632766098,-0.01257137767970562,0.05898452550172806,0.04832586646080017,0.030144110321998596,0.0022694068029522896,-0.044871654361486435,-0.028782904148101807,0.007494315970689058,-0.01753634214401245,0.024547334760427475,0.015831779688596725,0.016780458390712738,-0.02147091180086136,-0.021760426461696625,-0.0479733906686306,-0.027506040409207344,-0.050031740218400955,-0.036295391619205475,-0.0015689191641286016,-0.018323194235563278,-0.034715425223112106,-0.03568793833255768,-0.013929562643170357,0.06690268218517303,-0.028479939326643944,0.008643729612231255,-0.03733547776937485,1.926568256749306e-05,0.015950344502925873,0.09494607895612717,-4.098655335837975e-05,0.028128962963819504,0.0014065117575228214,0.0492820218205452,-0.05924690514802933,-0.06834858655929565,-0.025487134233117104,0.011077686212956905,0.04578358680009842,-0.039763111621141434,0.051268696784973145,0.023279935121536255,-0.03563078120350838,0.013864687643945217,-0.02131751738488674,0.037114910781383514,-0.010841607116162777,-0.01704927533864975,0.054371222853660583,-0.005054681561887264,0.028143538162112236,0.03470199182629585,0.035218168050050735,-0.06754278391599655,0.014809195883572102,-0.03398161381483078,0.06229846179485321,0.03920840844511986,0.01542708557099104,-0.0402882881462574,-0.053335387259721756,-0.030007254332304,0.004996689967811108,0.03190514072775841,0.07511879503726959,-0.03188128024339676,0.004299473017454147,0.002287994371727109,-0.05051574483513832,0.02124747447669506,0.05518777295947075,0.07664650678634644,-0.02923838421702385,0.03344143182039261,0.07807996869087219,-0.027148354798555374,0.0430552177131176,0.022297052666544914,-0.011297589167952538,0.05448264628648758,-0.016550438478589058,-0.006183402147144079,0.013510380871593952,-0.07045111060142517,-0.027686497196555138,-0.023301327601075172,-0.008910998702049255,-0.04938548430800438,0.03078891709446907,0.01592095196247101,-0.06841127574443817,-0.06604114174842834,-0.040643904358148575,0.00949017982929945,-0.0922469049692154,-0.007767742965370417,-0.015095916576683521,0.086201012134552,-0.012047291733324528,0.06155889108777046,-0.03482256084680557,0.0003363642899785191,-0.004405925516039133,-0.08924410492181778,0.040970347821712494,0.0056086028926074505,0.08771463483572006,-0.008024410344660282,-0.0035967309959232807,0.006664810236543417,-0.04776465892791748,0.022249842062592506,0.06639318913221359,0.03211677446961403,0.04004334658384323,0.06032686308026314,0.009633917361497879,-0.03389029949903488,0.011561227031052113,-0.004353424999862909,0.020603327080607414,-0.05680237337946892,0.03636457398533821,0.008558849804103374,-0.011547370813786983,-0.03175560384988785,0.01722288876771927,-0.06797028332948685,-0.02991962432861328,0.07262063026428223,-0.004859031643718481,-0.03612517565488815,0.07208594679832458,0.05607156828045845,0.020667508244514465,0.04881560057401657,-0.022980207577347755,0.03284741938114166,0.0009208073606714606,-0.06042748689651489,-0.10967013984918594,0.06910967081785202,0.058434028178453445,-0.08061421662569046,-0.0353245846927166,-0.022763578221201897,-0.06442474573850632,-0.0028314467053860426,0.047473352402448654,-0.0407550111413002,0.026578539982438087,-0.019290318712592125,0.042290765792131424,-0.06136266887187958,-0.029416153207421303,0.026940757408738136,-0.03672664985060692,-0.032875947654247284,-0.03925706073641777,0.021425724029541016,-0.07918289303779602,-0.009220619685947895,0.03090393729507923,-0.04201915115119027,0.04377664998893714,-0.02109549755367901',
                              pic_name='1.jpg',
                              nickname='hahaha',
                              gender=1,
                              city='budalagong',
                              province='xizang',
                              state=0,
                              blast_login_date='2019-3-15',
                              faceid='suibian',
                              joined_date1='2021-3-15',
                              joined_date2='2012-3-16',
                              avatarUrl='http://kkk.com',
                              codeVerify='12MMS',
                              type=1,
                              )

    def test_MemberView_get(self):
        '''
        会员管理首页，显示会员列表页面
        :return:
        '''
        response = self.client.post('/login/', data=self.login_user)
        expected_html = render_to_string('member/member_list.html')
        csrf_regex = r'<input[^>]+csrfmiddlewaretoken[^>]+>'
        expected_html = re.sub(csrf_regex, '', expected_html)
        print(expected_html)

    def test_MemberListView_get(self):
        """
        点击会员管理之后商品列表显示的单元测试
        若返回200状态码，表示可以登陆页面可以正常显示
        否则，系统BUG,需要检查修复
        :return:
        """
        # 没登陆时候的状态
        member = Member.objects.all()

        response = self.client.post('/login/', data=self.login_user)
        response = self.client.get('/member/member/list', dict(data=list(member)))
        print(response.content)
        self.assertEqual(response.status_code, 200)

    def test_MemberDetailView_get(self):
        """
        查看会员详情
        :return:
        """
        idd = {'id': 555}
        response = self.client.post('/login/', data=self.login_user)
        response = self.client.get('/member/member/detail', idd)

        self.assertEqual(response.status_code, 200)

    def test_MemberEnableView_post(self):
        data = {'id': 6667,
                'assin': 'ABCDE12345',
                'present_price': 1,
                'description': 'This is a test data',
                'title': 'test',
                'categories_id': 1,
                'brand': 'test',
                'status': 1,
                'buyDate': '2019-3-15',
                'warrantyDate': '2020-3-15', }
        # idd = {"assin": 'ABCDE12345'}
        response = self.client.post('/login/', data=self.login_user)
        response = self.client.post('/commodity/commodity/update', data=data)
        self.assertEqual(response.status_code, 200)


    def test_MemberDisableView_post(self):
        return None